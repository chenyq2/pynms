<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Extension Methods</title> <meta name="description" content="PyangBind is designed both as a means to generate data instances for YANG modules, but also as a software component that can be used in an NMS implementatio..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://pynms.io/pyangbind/extmethods"> <link rel="alternate" type="application/rss+xml" title="PyNMS" href="http://pynms.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="primary-nav"> <li><a href="/">Home</a></li> <li><a href="/about">About</a></li> <li><a href="/docs">Documentation Notes</a></li> <li><a href="/pyangbind">PyangBind Documentation</a></li> <li><a href="https://github.com/robshakir/pynms" target="_blank"><i class="icon icon-github"></i> GitHub</a></li> <!--<li><a href="http://twitter.com/robshakir" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li>--> <!-- <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i> RSS</a></li>--> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div> <h1 class="post-title" itemprop="name headline"><span class="controlled-title">PyangBind: Extension Methods</span></h1> </div> <div class="zone"> <span class="naviitem"><a class="naviitem" href="/pyangbind/">Overview</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/getting_started">Getting Started</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/usage">Usage</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/generic_methods">Generic Methods</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/errors">Errors</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/serialisation">Serialisation</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/xpath">XPATH</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/extmethods">Extension Methods</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/rpc">RPCs</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/yang">YANG Mapping</a></span> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>PyangBind is designed both as a means to generate data instances for YANG modules, but also as a software component that can be used in an NMS implementation. To that end, there can be requirements to tie methods to particular data instances in the tree.</p> <p>The extension methods (<code>extmethods</code>) functionality provides a means to tie arbitrary methods to a particular path in the tree.</p> <hr /> <h2 id="contents">Contents</h2> <ul> <li><a href="#initialisation">Initialisation of classes with <code>extmethods</code></a></li> <li><a href="#example-calls">Example calls with <code>extmethods</code></a></li> </ul> <h2 id="initialising-classes-with-extmethods-a-nameinitialisationa">Initialising Classes with <code>extmethods</code> <a name="initialisation"></a></h2> <p>To use extension methods, the PyangBind bindings must be generated with <code>--use-extmethods</code>. This ensures that the <code>extmethods</code> dictionary is propagated from parent to child objects as they are instantiated.</p> <p>The <code>extmethods</code> dictionary is of the form:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>  {
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/path/to/object/one</span><span style="color:#710">&quot;</span></span>: &lt;Class Instance&gt;,
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/path/to/object/two</span><span style="color:#710">&quot;</span></span>: &lt;Class instance&gt;
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>  }
</pre></div> </div> </div> <p>Where <code>/path/to/object/one</code> is defined as the XPATH to the object that the method is to be bound to <em>without</em> any filtering attributes. That is to say, for <code>/bgp/global/config/as</code> the path specified is simply <code>/bgp/global/config/as</code> whereas for <code>/bgp/neighbors/neighbor[peer-addr='192.0.2.1']/config/peer-as</code> then the path specified is <code>/bgp/neighbors/neighbor/config/peer-as</code>. It is not possible to bind an extension method to a single instance.</p> <p>Each object, as it is instantiated, then consults the <code>extmethods</code> dictionary, if it finds an entry which corresponds to its exact path, it inherits all methods of the class instance provided - and will proxy any calls to itself to that class. The names of the methods are prefixed by an underscore in order to avoid collisions between actual data element names and method names.</p> <hr /> <h2 id="example-calls-with-extmethods-a-nameexample-callsa">Example Calls with <code>extmethods</code> <a name="example-calls"></a></h2> <p>If one has the following class definition:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">openconfig</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">openconfig_bgp</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BgpNeighborHelper</span>(<span style="color:#369;font-weight:bold">object</span>):
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">soft_reset</span>(<span style="color:#069">self</span>, *args, **kwargs):
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>    <span style="color:#777"># Do a soft reset of the neighbor</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    <span style="color:#080;font-weight:bold">pass</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">hard_reset</span>(<span style="color:#069">self</span>, *args, **kwargs):
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>    <span style="color:#777"># Do a hard reset of the neighbor</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>    <span style="color:#080;font-weight:bold">pass</span>
</pre></div> </div> </div> <p>A set of PyangBind classes (e.g., OpenConfig BGP) can be initialised with an <code>extmethods</code> dictionary that provides a mapping between an instance of the <code>BGPNeighborHelper</code> class and an XPATH expression. For example, between the <code>config/enabled</code> leaf of each BGP neighbor and this class:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>bgp_helper =  BGPNeighborHelper()
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>extmethods = {
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bgp/neighbors/neighbor/neighbor/config/enabled</span><span style="color:#710">'</span></span>: bgp_helper
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>}
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>ocbgp = openconfig_bgp(extmethods=extmethods)
</pre></div> </div> </div> <p>Each entry within the <code>/bgp/neighbors/neighbor</code> list would have methods named <code>soft_reset</code> and <code>hard_reset</code> bound to their <code>config/enabled</code> leaf.</p> <p>i.e., a hard reset or soft reset could be initiated by calling:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>ocbgp.bgp.neighbors.neighbor[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1</span><span style="color:#710">&quot;</span></span>].config.enabled._hard_reset()
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>ocbgp.bgp.neighbors.neighbor[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">192.0.2.1</span><span style="color:#710">&quot;</span></span>].config.enabled._soft_reset()
</pre></div> </div> </div> <p>When this call is made, the instance of the <code>BgpNeighborHelper</code> class named <code>bgp_helper</code> (which was supplied in the <code>extmethods</code> dictionary) will receive a call to the <code>soft_reset</code> or <code>hard_reset</code> method).</p> <p>In addition to the arguments and keyword arguments that are supplied to the function (which are directly proxied through), two additional <code>kwargs</code> are added:</p> <ul> <li><code>caller</code> - this is a list which provides the components of the path of the actual object that the method was called against. For example in the above case this would correspond to <code>/bgp/neighbors/neighbor[peer-addr="192.0.2.1"].config.enabled</code> - and hence be <code>['bgp', 'neighbors', 'neighbor[peer-addr='192.0.2.1'], 'config', 'enabled']</code>. This allows disambiguation of calls that may come from multiple sources.</li> <li><code>path_helper</code> which provides a reference to the <code>path_helper</code> class that is being used by the classes. This can allow the <code>extmethod</code> to retrieve the data instance that called it if required.</li> </ul> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="https://github.com/robshakir" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://uk.linkedin.com/in/robjs" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/robshakir" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2016 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html><!-- by nandomoreira.me -->
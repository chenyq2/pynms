<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>RPCs in PyangBind</title> <meta name="description" content="PyangBind generates bindings for RPCs that are specified within a YANG module. The assumption is made that an RPC is not bound to any particular location wit..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://pynms.io/rpc"> <link rel="alternate" type="application/rss+xml" title="PyNMS" href="http://pynms.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="primary-nav"> <li><a href="/">Home</a></li> <li><a href="/about">About</a></li> <li><a href="/docs">Documentation Notes</a></li> <li><a href="/pyangbind">PyangBind Documentation</a></li> <li><a href="https://github.com/robshakir/pynms" target="_blank"><i class="icon icon-github"></i> GitHub</a></li> <!--<li><a href="http://twitter.com/robshakir" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li>--> <!-- <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i> RSS</a></li>--> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div> <h1 class="post-title" itemprop="name headline"><span class="controlled-title">PyangBind: RPCs in PyangBind</span></h1> </div> <div class="zone"> <span class="naviitem"><a class="naviitem" href="/pyangbind/">Overview</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/getting_started">Getting Started</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/usage">Usage</a></span> <span class="naviitem"><a class="naviitem" href="/pyangbind/generic_methods">Generic Methods</a></span> <span class="naviitem"><a class="naviitem" href="/errors">Errors</a></span> <span class="naviitem"><a class="naviitem" href="/serialisation">Serialisation</a></span> <span class="naviitem"><a class="naviitem" href="/xpath">XPATH</a></span> <span class="naviitem"><a class="naviitem" href="/extmethods">Extension Methods</a></span> <span class="naviitem"><a class="naviitem" href="/rpc">RPCs</a></span> <span class="naviitem"><a class="naviitem" href="/yang">YANG Mapping</a></span> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>PyangBind generates bindings for RPCs that are specified within a YANG module. The assumption is made that an RPC is not bound to any particular location within the data tree (the YANG 1.1 <code>action</code> statement is intended to meet this requirement). To this end, bindings are generated within a module named <code>&lt;yang module name&gt;_rpcs</code>.</p> <p>All RPC bindings have the property <code>register_paths</code> set to <code>False</code>. This results in them never using a <code>path_helper</code> object that is handed to them for <code>register()</code> or <code>unregister()</code> purposes. A <code>path_helper</code> class will still be used to resolve <code>leafref</code> values (and other XPATH expressions) if required.</p> <p>An class generated for an RPC has two member containers - <code>input</code> and <code>output</code> as per the specification provided in RFC6020. The corresponding data definitions are within these two elements (which act as per YANG containers).</p> <hr /> <h2 id="contents">Contents</h2> <ul> <li><a href="#examplerpc">Example RPC</a> <ul> <li><a href="#exinput">Generating an RPC <code>input</code></a></li> <li><a href="#exoutput">Parsing an RPC <code>output</code></a></li> <li><a href="#excode">Example Code</a></li> </ul> </li> </ul> <h2 id="example-rpc-a-nameexamplerpca">Example RPC <a name="examplerpc"></a></h2> <p>An example simple RPC could be defined as:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>    rpc test {
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>        input {
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>            container input-container {
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>                leaf argument-one {
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>                    type string;
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>                }
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>                leaf argument-two {
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>                    type uint8;
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>                }
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>            }
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>        }
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>        output {
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>            leaf response-id {
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>                type uint32;
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>            }
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>            list elements {
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>                leaf response-value {
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>                    type string;
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>                }
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>            }
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>        }
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>    }
</pre></div> </div> </div> <p>In this definition, the RPC <code>test</code> has an input that takes a <code>container</code> with two arguments (<code>argument-one</code> and <code>argument-two</code>) specified within it. It outputs an object that has a single <code>response-id</code> and a list of <code>elements</code> wtihin the reply. This list is not keyed (RPC outputs are defined to be <code>config false</code>).</p> <hr /> <h3 id="generating-an-rpc-input-a-nameexinputa">Generating an RPC Input <a name="exinput"></a></h3> <p>To generate an input for an RPC, the <code>input</code> container can be directly imported. If the example module above is generated with <code>--split-class-dir</code> into a module directory named <code>rbindings</code> then, for example:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">rbindings.simple_rpc_rpc.test.input</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">input</span>
</pre></div> </div> </div> <p>The <code>input</code> class can be instantiated and populated as per any other PyangBind class that represents a container:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>rpc_input = <span style="color:#369;font-weight:bold">input</span>()
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>rpc_input.input_container.argument_one = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test_call</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>rpc_input.input_container.argument_two = <span style="color:#00D">32</span>
</pre></div> </div> </div> <p>The object generated can be serialised to IETF JSON as per any other container using <code>dumps</code> from <code>pyangbind.lib.pybindJSON</code>:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>&gt;&gt; print(dumps(rpc_input, mode=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ietf</span><span style="color:#710">&quot;</span></span>))
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>{
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">simple_rpc:input-container</span><span style="color:#710">&quot;</span></span>: {
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">argument-two</span><span style="color:#710">&quot;</span></span>: <span style="color:#00D">32</span>, 
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">argument-one</span><span style="color:#710">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test_call</span><span style="color:#710">&quot;</span></span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>    }
<span class="line-numbers"><a href="#n7" name="n7">7</a></span>}
</pre></div> </div> </div> <hr /> <h3 id="parsing-an-rpc-output-a-nameexoutputa">Parsing an RPC Output <a name="exoutput"></a></h3> <p>In a similar manner, an RPC output can be read back into the corresponding <code>output</code> class using the standard deserialisation functionality in PyangBind. For example:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">rbindings.simple_rpc_rpc.test.output</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">output</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>rpc_output = output()
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>fn = os.path.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">json</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rpc-output.json</span><span style="color:#710">&quot;</span></span>)
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>json_obj = json.load(<span style="color:#369;font-weight:bold">open</span>(fn, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">r</span><span style="color:#710">'</span></span>))
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>pybindJSONDecoder.load_ietf_json(json_obj, <span style="color:#069">None</span>, <span style="color:#069">None</span>, obj=rpc_output)
</pre></div> </div> </div> <p>The output class can then be manipulated and/or read in Python:</p> <div class="highlighter-coderay"><div class="CodeRay"> <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>&gt;&gt;&gt; print(rpc_output.response_id)
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#00D">32</span>
</pre></div> </div> </div> <hr /> <h3 id="example-code">Example Code</h3> <p>The RPC example here can be found in <code>docs/example/simple-rpc</code>.</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="https://github.com/robshakir" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://uk.linkedin.com/in/robjs" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/robshakir" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2016 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html><!-- by nandomoreira.me -->